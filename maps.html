<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script type="text/javascript">

function getUrlParameter(sParam) {
    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;
    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};

var map;
function initMap() {
  var dataD = getUrlParameter('dataD').split('_');
  map = new google.maps.Map(document.getElementById('map'), {
    //sarÃ  centrata sul nodo di destinazione
    center: {lat: parseFloat(dataD[0]), lng: parseFloat(dataD[1])},
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    zoom: 11
  });

  var dataD = getUrlParameter('dataD').split('_');
  var marker = new google.maps.Marker({
    map: map,
    animation: google.maps.Animation.DROP,
    position: {lat: parseFloat(dataD[0]), lng: parseFloat(dataD[1])},
    title: 'Destinazione',
    label: 'D'
  });

  var infowindow = new google.maps.InfoWindow();
  marker.addListener('click', function() {
    infowindow.setContent('Destinazione');
    infowindow.open(map, marker);
  });

  var dataM = getUrlParameter('dataM');
  var machineParam = dataM.split('|');
  var markers = [];
  for (i = 0; i < machineParam.length; i++) {
    var mach_tmp = machineParam[i].split('_');
    markers[i] = new google.maps.Marker({
      map: map,
      animation: google.maps.Animation.DROP,
      position: {lat: parseFloat(mach_tmp[2]), lng: parseFloat(mach_tmp[3])},
      title: mach_tmp[1],
      label: mach_tmp[0]
    });

    google.maps.event.addListener(markers[i], 'click', (function(markers, mach_tmp, i) {
      return function() {
        infowindow.setContent(mach_tmp[1]);
        infowindow.open(map, markers[i]);
      }
    })(markers, mach_tmp, i));
  }

}

    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB27xz94JVRPsuX4qJMMiZpGVoQiQITFb8&callback=initMap">
    </script>
  </body>
</html>
